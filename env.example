# ═══════════════════════════════════════════════════════════════════
# AML Node Backend - Environment Configuration
# Copy this file to .env and update with your values
# ═══════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────
# Server Configuration
# ─────────────────────────────────────────────────────────────────
PORT=3001
NODE_ENV=production

# ─────────────────────────────────────────────────────────────────
# PostgreSQL Database Configuration
# ─────────────────────────────────────────────────────────────────
# For local development or Cloud SQL Auth Proxy:
DB_HOST=localhost
DB_PORT=5432

# For GCP Cloud Run / App Engine (Unix socket connection):
# Uncomment these and comment out DB_HOST/DB_PORT above
# DB_SOCKET_PATH=/cloudsql
# DB_INSTANCE_CONNECTION_NAME=project-id:region:instance-name

# Database credentials
DB_NAME=your_database_name
DB_USER=your_username
DB_PASSWORD=your_password

# ─────────────────────────────────────────────────────────────────
# Connection Pool Settings
# Adjust based on Cloud SQL instance size and expected traffic
# ─────────────────────────────────────────────────────────────────
DB_POOL_MIN=2
DB_POOL_MAX=10
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=10000

# ─────────────────────────────────────────────────────────────────
# SSL Configuration (for Cloud SQL)
# ─────────────────────────────────────────────────────────────────
# Enable SSL for direct Cloud SQL connections
DB_SSL=false
DB_SSL_REJECT_UNAUTHORIZED=true

# Optional: Path to SSL certificates (for direct connections without proxy)
# DB_SSL_CA=/path/to/server-ca.pem
# DB_SSL_CERT=/path/to/client-cert.pem
# DB_SSL_KEY=/path/to/client-key.pem

# ─────────────────────────────────────────────────────────────────
# Query Safety Limits
# ─────────────────────────────────────────────────────────────────
# Maximum query execution time in milliseconds
DB_STATEMENT_TIMEOUT=30000

# Maximum query length (characters)
MAX_QUERY_LENGTH=50000

# Maximum parameters per query
MAX_QUERY_PARAMS=1000

# Maximum queries in batch request
MAX_BATCH_SIZE=50

# Maximum queries in transaction
MAX_TRANSACTION_SIZE=20

# Maximum rows in single insert
MAX_INSERT_ROWS=1000

# ─────────────────────────────────────────────────────────────────
# API Security
# ─────────────────────────────────────────────────────────────────
# REQUIRED: Generate a strong random key (min 32 chars)
# openssl rand -hex 32
API_KEY=your-secret-api-key-minimum-32-characters

# ─────────────────────────────────────────────────────────────────
# Rate Limiting
# ─────────────────────────────────────────────────────────────────
# Requests per window
RATE_LIMIT_MAX_REQUESTS=100
# Window duration in milliseconds
RATE_LIMIT_WINDOW_MS=60000
# Burst limit (requests per second)
RATE_LIMIT_BURST=20

# ─────────────────────────────────────────────────────────────────
# IP Access Control (optional but recommended for production)
# ─────────────────────────────────────────────────────────────────
# Comma-separated list of allowed IPs/CIDRs
# Supports: exact IP, CIDR (/8, /16, /24), wildcard (10.0.0.*)
# IP_ALLOWLIST=10.0.0.0/8,192.168.1.0/24

# Comma-separated list of blocked IPs
# IP_BLOCKLIST=1.2.3.4,5.6.7.8

# ─────────────────────────────────────────────────────────────────
# CORS Configuration
# ─────────────────────────────────────────────────────────────────
# Comma-separated list of allowed origins
# Use * to allow all (not recommended for production)
ALLOWED_ORIGINS=https://your-nextjs-app.vercel.app,https://your-domain.com

# ─────────────────────────────────────────────────────────────────
# Request Limits
# ─────────────────────────────────────────────────────────────────
# Maximum request body size
MAX_REQUEST_SIZE=1mb

# ─────────────────────────────────────────────────────────────────
# Table Access Control (optional)
# ─────────────────────────────────────────────────────────────────
# Comma-separated list of allowed tables (if set, only these can be accessed)
# ALLOWED_TABLES=users,orders,products

# Comma-separated list of blocked table prefixes (default: pg_,information_schema)
# BLOCKED_TABLES=pg_,information_schema,_prisma_migrations

# ─────────────────────────────────────────────────────────────────
# SQL Validation
# ─────────────────────────────────────────────────────────────────
# Enable strict SQL validation even in development
STRICT_SQL_VALIDATION=true

# ─────────────────────────────────────────────────────────────────
# Redis Configuration (for distributed rate limiting)
# ─────────────────────────────────────────────────────────────────
# Option 1: Use Redis URL (for Redis Cloud, Upstash, etc.)
# REDIS_URL=redis://user:password@host:6379

# Option 2: Use individual settings (for GCP Memorystore)
# REDIS_HOST=10.0.0.3
# REDIS_PORT=6379
# REDIS_PASSWORD=your_redis_password
# REDIS_DB=0

# Enable TLS for Redis (required for some managed Redis services)
# REDIS_TLS=true
# REDIS_TLS_REJECT_UNAUTHORIZED=true

# Key prefix for rate limiting (useful if sharing Redis instance)
RATE_LIMIT_PREFIX=aml:rl:

# ─────────────────────────────────────────────────────────────────
# Logging
# ─────────────────────────────────────────────────────────────────
# Log all requests (not just errors)
LOG_ALL_REQUESTS=false
